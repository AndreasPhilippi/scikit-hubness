language: python
sudo: false


env:
  global:
  - CACHE_DIR="$HOME/virtualenv"
  - MINICONDA_DIR="$HOME/miniconda"
  - PYTHONIOENCODING=UTF8

python:
- '3.7'

install:
  - travis/install-conda.sh
  - export PATH="$PATH:$HOME/miniconda/bin"
  - hash -r
  - travis/install-pip.sh
  - python setup.py build
  - python setup.py install

#- wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh;
#- bash miniconda.sh -b -p $HOME/miniconda;
#- export PATH="$HOME/miniconda/bin:$PATH"
#- hash -r
#- conda config --set always_yes yes --set changeps1 no
#- conda update -q conda
#- conda info -a
#- conda create -q -n test-environment python=$TRAVIS_PYTHON_VERSION numpy scipy pandas scikit-learn
#- source activate test-environment
#- pip install joblib falconn nmslib nose codecov pytest pytest-cov coverage


before_script:
  - flake8 --exit-zero .

script:
- python setup.py test
- pytest --cov=./
# - coverage run setup.py test
# - coverage combine # required for multiprocessing

after_success:
- codecov --token=5d0d5dd0-2e59-47b8-8a2b-dbdc0fbb4e4c  # only for private repo

cache:
# - apt
- pip
- ccache
- packages
- directories:
  - "$HOME/.cache/pip"
  - "$HOME/virtualenv"
  - "$HOME/miniconda"
  -
# safelist
branches:
  only:
  - master
  - develop
